# ONNX OCR Pipeline

A standalone OCR pipeline using ONNX models for text detection and recognition.

## Installation

```bash
pip install -r requirements.txt

# For GPU support:
pip install onnxruntime-gpu
```

## Usage

### Python API

```python
from ocr_pipeline import OCRPipeline

# Initialize pipeline
ocr = OCRPipeline(".")

# Process single image
results = ocr.predict("image.jpg")
for r in results:
    print(f"Text: {r['text']}, Confidence: {r['confidence']:.2f}")
    print(f"Box: {r['box']}")

# Process multiple images
results = ocr.predict(["img1.jpg", "img2.jpg", "img3.jpg"])
```

### CLI

```bash
# Process single image
python -m ocr_pipeline . image.jpg

# Process multiple images
python -m ocr_pipeline . img1.jpg img2.jpg img3.jpg

# Save results to JSON
python -m ocr_pipeline . image.jpg -o results.json

# Adjust detection parameters
python -m ocr_pipeline . image.jpg --det-limit 1280 --det-thresh 0.2
```

## Output Format

Results are returned as a list of dictionaries:

```python
[
    {
        "text": "detected text",
        "box": [[x1,y1], [x2,y2], [x3,y3], [x4,y4]],  # Quadrilateral corners
        "confidence": 0.95
    },
    ...
]
```

## Model Files

```
models/
├── det_model.onnx      # Text detection model (DB algorithm)
├── rec_model.onnx      # Text recognition model (CTC-based)
└── dictionary.txt      # Character dictionary
```

## Configuration

The `OCRPipeline` class accepts the following parameters:

| Parameter | Default | Description |
|-----------|---------|-------------|
| `model_dir` | (required) | Path to pipeline directory |
| `det_limit_side_len` | 960 | Max side length for detection resize |
| `det_limit_type` | "max" | Resize limit type: "max" or "min" |
| `det_thresh` | 0.3 | Detection binarization threshold |
| `det_box_thresh` | 0.6 | Detection box score threshold |
| `det_unclip_ratio` | 1.5 | Box expansion ratio |

## Generated By

This pipeline was exported from PaddleOCR using:
```bash
python tools/export_onnx/export_pipeline.py
```
